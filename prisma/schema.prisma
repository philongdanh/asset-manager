generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model Organization {
  organization_id Int             @id @default(autoincrement()) @map("organization_id")
  org_name        String
  status          String?
  categories      AssetCategory[]
  assets          Asset[]
  roles           Role[]
  users           User[]

  @@map("organizations")
}

model User {
  user_id         Int                @id @default(autoincrement()) @map("user_id")
  organization_id Int
  username        String             @unique
  email           String?            @unique
  display_name    String?
  is_active       Boolean            @default(true)
  transactions    AssetTransaction[] @relation("UserTransactions")
  createdAssets   Asset[]            @relation("UserCreatedAssets")
  organization    Organization       @relation(fields: [organization_id], references: [organization_id])

  @@map("users")
}

model Role {
  role_id         Int          @id @default(autoincrement()) @map("role_id")
  organization_id Int
  role_name       String
  organization    Organization @relation(fields: [organization_id], references: [organization_id])

  @@unique([organization_id, role_name])
  @@map("roles")
}

model Permission {
  permission_id Int    @id @default(autoincrement()) @map("permission_id")
  name          String @unique

  @@map("permissions")
}

model UserRole {
  user_id Int
  role_id Int

  @@id([user_id, role_id])
  @@map("user_roles")
}

model RolePermission {
  role_id       Int
  permission_id Int

  @@id([role_id, permission_id])
  @@map("role_permissions")
}

model AssetCategory {
  category_id         Int          @id @default(autoincrement()) @map("category_id")
  organization_id     Int
  category_name       String
  depreciation_method String?
  default_life_years  Int?
  organization        Organization @relation(fields: [organization_id], references: [organization_id])
  assets              Asset[]

  @@unique([organization_id, category_name])
  @@map("asset_categories")
}

model Asset {
  asset_id           Int                 @id @default(autoincrement()) @map("asset_id")
  organization_id    Int
  asset_code         String?
  asset_name         String?
  category_id        Int?
  purchase_date      DateTime?
  original_cost      Float?
  current_value      Float?
  asset_status       String?
  current_location   String?
  created_by_user_id Int?
  depreciations      AssetDepreciation[]
  transactions       AssetTransaction[]
  category           AssetCategory?      @relation(fields: [category_id], references: [category_id])
  created_by         User?               @relation("UserCreatedAssets", fields: [created_by_user_id], references: [user_id])
  organization       Organization        @relation(fields: [organization_id], references: [organization_id])

  @@unique([organization_id, asset_code])
  @@map("assets")
}

model AssetDepreciation {
  depreciation_id          Int      @id @default(autoincrement()) @map("depreciation_id")
  asset_id                 Int
  depreciation_date        DateTime
  depreciation_amount      Float
  accumulated_depreciation Float
  remaining_value          Float
  asset                    Asset    @relation(fields: [asset_id], references: [asset_id])

  @@unique([asset_id, depreciation_date])
  @@map("asset_depreciation")
}

model AssetTransaction {
  transaction_id       Int       @id @default(autoincrement()) @map("transaction_id")
  asset_id             Int
  transaction_type     String
  transaction_date     DateTime?
  from_location        String?
  to_location          String?
  performed_by_user_id Int?
  asset                Asset     @relation(fields: [asset_id], references: [asset_id])
  performed_by         User?     @relation("UserTransactions", fields: [performed_by_user_id], references: [user_id])

  @@map("asset_transactions")
}
